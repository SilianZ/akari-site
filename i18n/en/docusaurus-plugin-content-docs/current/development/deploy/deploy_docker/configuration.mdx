---
sidebar_position: 4
description: Configure small size
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Configuration

Download the `config` folder from a small GitHub repository and place it in a pre-prepared directory.

Go to the `config.toml.example` folder, rename `config.toml` to `config.toml` and start configuring what you need.

:::info

Since the current configuration suffix is changed to `toml`, unlike `cfg`, please delete the empty fields in all configuration files after filling out the required fields otherwise the program cannot function properly.If you have an old `cfg` file, the robot will automatically help you convert to the `toml` format.

:::

## Configure Database

:::info

Robots need a database to store user data. For the first simple deployment, we need only focus on database fields and the rest can be left blank.

:::

This field requires a database link supported by `sqlalchemy`. Below is a recommended option. Please select an：

### MySQL

Use `MySQL` as primary database：

**Format**：`db_path = "mysql+pymysql:/<Database Username>:<Database Userpassword >@<Database Address>"`

**Practical example**：`db_path = "mysql+pymysql:/bot:123456@example.com/bot_prod"`

### SQLite

:::info

Use SQLite is the best option if you do not want to study how to install a database (or buy a provider's database service) in order to deploy a robot.The disadvantage is that there may be a lock table problem (very low probability of occurring) and a future shipping error (error deleting db and no backup) leading to the destruction of the original user's data.

:::

If you select SQLite, simply fill in the fields in the following format.无需再关注数据库搭建等问题：

**Format**：`db_path = "sqlite://<Relative Path>/<Database Filename >.db"`

**Practical example**：`db_path = "sqlite://database/save.db"`

This example will create `save.db` in the `database` folder to store user data.

## Configure Platform Robots

### QQ

We have used [aiocqhttp](https://github.com/nonebot/aiocqhttp) here to use [go-cqhttp](https://github.com/Mrs4s/go-cqhttp).

:::info

According to the go-cqtt's official warehouse message：[The future of QQ Bot and the migration proposal](https://github.com/Mrs4s/go-cqhttp/issues/2471), developers are no longer able to maintain this project.

:::

A newly registered QQ account needs only to complete the base configuration. In order to avoid problems such as Code45 when the robot is used, we recommend configuring the signature server to follow the stage configuration.

#### Base Configuration

If you want to use Docker to deploy go-cqhttp, go to [use Docker](https://docs.go-cqhttp.org/guide/docker.html).

1.  Download the latest [Release]from the official repository of go-cqp (https://github.com/Mrs4s/go-cqhttp/releases/latest).

    | System type         | Executable Files                    | Compress File                        |
    | ------------------- | ----------------------------------- | ------------------------------------ |
    | Intel version Macos | Not available                       | `go-cqhttp_darwin_amd64.tar.gz`      |
    | M1 Macos            | Not available                       | `go-cqhttp_darwin_arm64.tar.gz`      |
    | 32-bit Linux        | Not available                       | `go-cqhttp_linux_386.tar.gz`         |
    | 64-bit Linux        | Not available                       | `go-cqhttp_linux_amd64.tar.gz`       |
    | arm64 Linux         | Not available                       | `go-cqhttp_linux_arm64.tar.gz`       |
    | armv7 Linux         | Not available                       | `go-cqhttp_linux_armv7.tar.gz`       |
    | 32-bit Windows      | `go-cqhttp_windows_386.exe`         | `go-cqhttp_windows_386.zip`          |
    | 64-bit Windows      | `go-cqhttp_windows_amd64.exe`       | `go-cqhttp_windows_amd64.zip`        |
    | arm64 Windows       | `go-cqhttp_windows_arm64.exe`       | `go-cqhttp_windows_arm64.zip`        |
    | armv7 Windows       | `go-cqhttp_windows_armv7.exe`       | `go-cqhttp_windows_armv7.zip`        |

2.  Unpack downloaded files into a pre-prepared folder.

3.  Run go-cqhttp.

4.  Hint： at this time

    ```
    [WARNING]: Failed to load configuration config.yml : file does not exist in
    [INFO]: default configuration file has been generated, please edit config.yml and restart application.
    ```

    The program will automatically generate a default configuration `config.yml` in the directory of the go-cqHTML folder.

    Next, configure how to connect to the go-cqHP `config.yml` file.

    ```yml title="config.yml"
    ...
    # Connecting services list
    servers:
      # Add method, multiple connections with the same connection method, Body profile check the document
      #- http: # HTML Communication
      #- ws: # +Websocket
      #- ws-reverse: # Reverse Websocket
      #- pprof: # Performance Analysis Server
      - Ws-reverse:
          universal: ws:/127. .0.1:11451/ws/# Enter the previous IP address and port here, Do not delete the following /ws/
          reconnect-interval: 3000
          middle leware:
            <: *default # quotes default middle
      .
    ...
    ```

    Please fill in the following field： in the small robot configuration `config.toml`

    `qq_host = "127.0.0.1:11451"` - A Websocket server will be opened in completed IP addresses and ports for go-cqp reverse connections.

    `qq_account = 2314163511` - Enter the bot's QQ number.

    :::info

    If you have problems with the configuration, please refer to the [go-cqHP official documentation] \(https://docs.go-cqhttp.org/).

    :::

##### Advanced Configuration (Configure Signing Server)

If Code45 is reported as a result of the enhancement of the QQ wind control mechanism, please refer to the steps below to configure the signing server：

5.  Install JRE 17 (Save Runtime Environment 17). Please find your installation methods using the search engine.

6.  Download the latest version of unidbg-fetch-qsign in ~[unidbg-fetch-qsign](https://github.com/fuqiuluo/unidbg-fetch-qsign)~(author has deleted the library, please search on GitHub for a repository on `qsign` and unload it into a preprepared folder.

7.  Delete the `data` folder and the `device.json` file in the same directory as go-cqtar.

8.  Run： below in folder with unidbg-fetch-qsign

    ```sh
    bin\unidbg-fetch-qsign --basePath=txlib\<Your version >
    ```

    Please replace the `<version >` field with the existing version of the `txlib` folder on the `txlib` folder in the deposit of unidbg-fetch-qsign.

    Example：`--basePath=txlib\8.9.73`

    :::info

    When selecting a version, the following principles should be followed for：
    upgrade version should be **a version of **, and may not have the opportunity to return the version later.Code45 should first try deleting the go-cq's `device.json` file and the `data\cache` folder and log in again instead of upgrading the first time.

    :::

9.  Configure the `config.yml` file of go-cqp by previous steps.

10. Next, please configure the signing server： in the `config.yml` file of go-cq.

    ```yml title="config.yml"
    Account: # account related
      # of packet signing server listing, first as primary signing server, followed by alternate
      sign-server:
        - url: 'http://127. .0.1:8080' # Primary Signing Server address, required
          key: '114514' # # signature server needs apikey, if the signature server is version 1. This is invalid
          authorization: '-' # authorization according to server settings, such as 'Bear xxx'
        .
      ...

    ```

11. Run go-cqHTML to generate device files.

12. Download the corresponding version of[安卓手机协议](https://github.com/MrXiaoM/qsign/blob/mirai/txlib/) and rename it to `1.json`.Save this file in the `data\versions` folder on the same directory as go-cqWP.

13. In the `device.json` folder in the same directory as go-cqHP and modify the following field：

    ```json title="device.json"
    "protocol": 1,
    ```

14. Restart go-cqip complete final configuration.

### Discord

We have used [Pycord](https://github.com/Pycord-Development/pycord) here to call the Discord API.

To achieve this, you need to create a robot on [Discord Developer's Platform](https://discord.com/developers) and get token.

`dc_token=` - Fill out the robot token you received.

### Telegram

We have used [AIOGram](https://github.com/aiogram/aiogram) here to asynchronize Telegram API.

To achieve this, you need to search for `@BotFather` in Telegram to create robots.

`tg_token=` - Fill in the robot Token you obtain.

### Kook

You need to create a robot on the [Kook Developer Platform](https://developer.keokapp.cn/) and get token.

`kok_token=` - Fill out the robot token you received.

### Matrix

You need to register and log in on your own account.

`matrix_homeserver =` - Fill out the Matrix server URL you use (only protocols and hosts, no need to add `/`).

`matrix_user =` - Fill out the robot's [fully qualified user ID](https://spec.matrix.org/v1.7/appendices/#user-identifiers) (including `@` and \`:\`\`).

`matrix_device_id=` - Fill the robot's device ID (i.e. Element Session ID)

`matrix_device_name =` - Fill in the name of the robot's device (indiscriminate, visible to people)

`matrix_token=` - Fill in access tokens for any robot device.

:::info

Not recommended to get access tokens from other clients, which can easily cause confused conversations.
If you want to use the client to get access tokens (no fear of death), don't use the client's exit login, it is recommended to login and get tokens in your browser private mode.

:::

```sh
curl -XPOST -d '{"type":"m.login.password", "user":"<user>", "password":"<password>"}" "https://<homeserver>/_matrix/client/r0/login"
```

#### E2E Encryption

Currently, robots do not enable end-to-end encryption (E2EE) support by default because libolm needs to be configured manually.

To enable E2EE support, please execute the following command：

```sh
postry run -- pip3 install matrix-nio[e2e] ; Poetry
pip3 install matrix-nio[e2e] ; PIP
```

`matrix_megolm_backup_passphase =` - (optionally) fill out the robot's megolm for a backup phrase, it is recommended to use a random long password, not export megolm backup.

If you want to import megol, place the backup file under `matrix_store/megolm_backup/restore.txt` and write the password phrase `matrix_store/megolm_backup/restore-passphrase.txt`.

## Configure Other Features

Some features need further configuration to be used because they can be more functional.

Some fields may not have been manually added in `config.toml.example`.

### Block words

It is built-in to[阿里云内容安全服务](https://www.aliyun.com/product/lvwang), which can be used to check the safety of sending text below the QQ and Kook platform for robot account security.

If required, go to Aliyun to open and get Access KeyID and Access KeySecretari.The unfilled field will not use the block word service.

Please also note that because of the Aliyun policy limitations, the content security service**'s non-personal developer** will not call the interface even if the account is not authenticated with the Aliyun enterprise.

`check_accessKeyId =` - Fill in Access KeyID.

`check_accessKeySecret =` - Fill Access KeySecretaries.

### QQ Channel Message Processing (Beta)

Using [aiocqhttp](https://github.com/nonebot/aiocqhttp) above on [go-cqhttp](https://github.com/Mrs4s/go-cqhttp), you can select if you want to enable QQ channel message processing.

Based on a go-cq-tarp document, the iPad/Android Pad / Android Phone protocol supports processing QQ channel messages. The `"protocol":6,` field can be found in the generated `device.json`, and the value of this site can be changed to 1 (Android Phone), 5 (iPad) or 6 (Android Pad) any one at all.

:::warning

The processing of QQ channel messages is still at the test stage, the message inside the channel cannot be withdrawn due to imperfect support for go-cqf channel messages, and the channel list will not be automatically refreshed (adding a new channel requires a manual restart of gocqhttp).

:::

:::info

For code45 or other login issues that arise when go-cqHP is logged in using the above method, please resolve them by reference to go-cq-http's official [Issue](https://github.com/Mrs4s/go-cqhttp) or choose to use protocols other than the above protocol.

:::

### Webrender

This is a small external service.Access agents primarily handle html rendering images and some features.

#### Deployment

1.  This service is written using JavaScript, driven by `Puppereer`, for which you need to install [Node.js](https://nodejs.org/) environment and [Chrome](https://google.cn/intl/en-CN/chrome/).

2.  Download[源代码文件](https://github.com/Teahouse-Studios/oa-web-render) and install dependency on `npm install` within the terminal.

3.  Create `.env` file in `package.json` and fill in the following field：

    ```conf title=".env"
    CHROMIUM_PATH="C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" # absolute path
    FC_SERVER_PORT=15551 # to fill out the running port of the service
    ```

    :::info

    After completing the configuration file, delete all the annotations in the configuration files, otherwise the configuration could not be read correctly.

    :::

4.  In the terminal, use `node ./src/index.js` to open the service.Service does not have any content output.

You can also deploy this service using the cloud service provider Serverless service.

#### Field Fill

\``web_render =` - Webrender address (IP or domain name) and port.

`web_render_local =` - Local Webrender address.(can be the same parameter as previous field)

**Example**

\`\`web_render = "http://127.0.0.0.1:15551""

### Modules

#### coin

The `coin` module requires some additional parameters to work properly.

`coin_limit = 10000` - Maximum number of coins that can be thrown at once.

`coin_faceup_rate = 4994` - coins face up to the probability that they will be counted in a few thousands.

`coin_facedown_rate = 4994` - coin_face-to-face probability of coin_face-to-face upward, calculated by ten thousands.

#### dice

The `dice` module requires some additional arguments to work properly.

`dice_limit = 10000` - Maximum number of dice that can be thrown at once.

`dice_roll_limit = 100` - Maximum number of times the dice is thrown.

`dice_mod_max = 10000` - Maximum value for dice throwing.

`dice_mod_min = -10000` - Minimum tuning value for dice throwing.

`dice_output_cnt = 50` - max data on output, cannot be displayed properly

`dice_detail_cnt=5` - the total number of multiple dice throws, no longer showing details.

`dice_count_limit = 10` - the maximum number of multiple items.

#### maimai

The `maimai` module is based on [mai-bot](https://github.com/Diving-Fish/mai-bot) modifications.This module requires additional resource files to work properly.

1.  Download[资源文件](https://www.diving-fish.com/maibot/static.zip), create a `maimai` folder in the `assets` folder.

2.  Extract resource files from：

    ```angular2html
    assetss
    allowing them to maimai
        — static
            together with @adobe_simhei.otf
            too much aliases.csv
            @msyh.ttc
            >
            - mai
                x...
    ```

#### Secret

The contents of this module are mainly used to monitor Minecraft Wiki registration and abuse logs, and to remove folders directly from this module if not required.

#### wolframalpha

The `wolflramalpha` module requires some additional parameters to work properly.

To achieve this, you need to sign up to [Wolfram|Alpha Developer's Platform](https://developer.wolframalpa.com/) and request a Simple API, then fill out the following field：

`wolfram_alpha_appid=` - Wolfrra|Alpha APPID.

### Other features

`base_superuser =` - Set robot master superuser.Available formats are `QQ|<QQ号>Discord|Client|<ClientID>`, `Telegram|Client|<ClientID>`, `Kook|User|<UserID>`, can be used to view your own IDs after robot starts and automatically mark objects as superusers.

`q_disable_temp_session = true` - Whether to disable temporary session functions for QQ platform.

`q_enable_listening_self_message = false` - Whether to enable self-handling of the QQ platform (may help to use under multiple devices, but may also cause the error to trigger the message into a life-cycle state).

`enable_dirty_check = true` - Enable block word check.

`enable_urlmanager=true` - Enable URL management (replace external links, prompt to unofficial pages).Disabling this feature will also disable the `wiki_audit` command.

`slower_schedule = false` - Some scheduled task modules are executed using longer intervals, which may help to optimize the network environment.

`enable_tos = false` - Enable built-in check for violation of terms of service.

`enable_analytics = true` - Whether to enable the built-in `analytics` command for how many times statistical commands are used.

`enable_eval = true` - whether the built-in `eval` command is enabled.

`allow_request_private_ip = true` - Allow robots to request private IP addresses.

### Custom confirmation word and command prefix

You can add (or delete) the default prefix that you can use by editing the `confirmed_command` in the configuration file to add (or delete) the default prefix that the robot will ask the user to continue in some scenarios.

The first `command_prefix` will be used as a default prefix to help the document show.
